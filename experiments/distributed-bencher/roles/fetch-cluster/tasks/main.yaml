- name: Get docker logs
  shell: "docker logs {{ node_name_prefix }}{{ item | int + 1 }} > /tmp/{{ node_name_prefix }}{{ item | int + 1 }}.out 2> /tmp/{{ node_name_prefix }}{{ item | int + 1 }}.err"
  with_sequence: start=0 count={{ node_count }}
  when: (item|int % (ansible_play_hosts | length)) == ansible_play_hosts.index(inventory_hostname)
  register: logs
  ignore_errors: true

- name: Fetch logs (out)
  fetch:
    src: "/tmp/{{ node_name_prefix }}{{ item | int + 1 }}.out"
    dest: "{{ logs_dir }}/{{ node_name_prefix }}{{ item | int + 1 }}.out"
    flat: true
  with_sequence: start=0 count={{ node_count }}
  when:
    - (item|int % (ansible_play_hosts | length)) == ansible_play_hosts.index(inventory_hostname)
    - logs is succeeded

- name: Fetch logs (err)
  fetch:
    src: "/tmp/{{ node_name_prefix }}{{ item | int + 1 }}.err"
    dest: "{{ logs_dir }}/{{ node_name_prefix }}{{ item | int + 1 }}.err"
    flat: true
  with_sequence: start=0 count={{ node_count }}
  when:
    - (item|int % (ansible_play_hosts | length)) == ansible_play_hosts.index(inventory_hostname)
    - logs is succeeded
