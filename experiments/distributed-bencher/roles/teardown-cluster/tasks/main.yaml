- name: Get docker logs
  shell: "docker logs node-{{ item }} > /tmp/node-{{ item }}.out 2> /tmp/node-{{ item }}.err"
  with_sequence: count={{ node_count }}
  when: (item|int % (ansible_play_hosts | length)) == ansible_play_hosts.index(inventory_hostname)

- name: Fetch logs (out)
  fetch:
    src: "/tmp/node-{{ item }}.out"
    dest: "logs/node-{{ item }}.out"
    flat: true
  with_sequence: count={{ node_count }}
  when: (item|int % (ansible_play_hosts | length)) == ansible_play_hosts.index(inventory_hostname)

- name: Fetch logs (err)
  fetch:
    src: "/tmp/node-{{ item }}.err"
    dest: "logs/node-{{ item }}.err"
    flat: true
  with_sequence: count={{ node_count }}
  when: (item|int % (ansible_play_hosts | length)) == ansible_play_hosts.index(inventory_hostname)

- name: Remove etcd docker images
  docker_image:
    state: absent
    name: "node-{{ item }}"
    source: pull
  with_sequence: count={{ node_count }}
  when: (item|int % (ansible_play_hosts | length)) == ansible_play_hosts.index(inventory_hostname)
